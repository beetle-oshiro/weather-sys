<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>weather</title>
</head>

<body>
    <!-- éƒ½å¸‚ãŒå…¥åŠ›ã•ã‚Œã‚‹ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã€€placeholderã¯å…¥åŠ›å‰ã«è–„ãè¡¨ç¤ºã•ã‚Œã‚‹ -->
    <input type="text" id="id_city" placeholder="éƒ½å¸‚åã‚’å…¥åŠ›">
    <!-- å¤©æ°—ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ãƒœã‚¿ãƒ³ã€€JavaScriptãŒå‹•ããƒˆãƒªã‚¬ãƒ¼ã«ãªã£ã¦ã„ã‚‹ -->
    <button id="id_btn">å¤©æ°—ã‚’å–å¾—</button>
    <!-- éƒ½å¸‚ã®å¤©æ°—æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹éƒ¨åˆ† -->
    <div id="id_result"></div>

    <script>
        window.addEventListener("DOMContentLoaded", init);      //htmlãŒå…¨ã¦èª­ã¿çµ‚ã‚ã£ãŸå¾Œã§initã‚’å®Ÿè¡Œã•ã›ã‚‹

        function init() {

            // ã€Œå¤©æ°—ã‚’å–å¾—ãƒœã‚¿ãƒ³ã€ã®ã‚¤ãƒ™ãƒ³ãƒˆã€€éåŒæœŸé€šä¿¡ï¼ˆfetchï¼‰ã‚’ä½¿ã†ã‹ã‚‰ã€Œasyncã€ã‚’ä»˜ã‘ã‚‹â†’ä¸­ã§ã€Œawaitã€ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹
            document.getElementById("id_btn").addEventListener("click", async () => {
                // å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—ãŒåŠè§’ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
                const input = document.getElementById("id_city");
                const city = input.value.trim();                    //ã€Œ.trim()ã¯å‰å¾Œã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤ï¼ˆç©ºç™½ã®ãƒŸã‚¹é˜²æ­¢ï¼‰ã€
                const alphabet_check = /^[a-zA-Z]+$/.test(city);

                if (!alphabet_check) {
                    alert("éƒ½å¸‚åã¯åŠè§’ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
                    return;
                }

                const result = document.getElementById("id_result");
                result.innerHTML = "ğŸ”„ èª¿ã¹ã¦ã„ã¾ã™...";

                const apiKey = "f16a0932e81de680d52be30e43ff82da"; // ã“ã“ã«APIã‚­ãƒ¼ã‚’å…¥ã‚Œã‚‹
                const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=ja`;

                try {
                    // ã“ã“ã‹ã‚‰å…ˆã§ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šã«ã„ãã®ã§ã€å°‘ã—å¾…ã£ã¦ã‚‚ã‚‰ã†ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹å¾…ã¡ï¼‰
                    const response = await fetch(url);
                    //  ã€Œresponse.okã€ã«ã¯ã€Œtrue or falseã€ãŒè¿”ã£ã¦ãã‚‹ã®ã§ifæ–‡ã§èª¿ã¹ã‚‹    
                    if (!response.ok) {
                        throw new Error("ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");  //Errorã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦messageãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«()å†…ã®æ–‡è¨€ã‚’å…¥ã‚Œã‚‹
                    }

                    const data = await response.json();     //ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¿”ã£ã¦ããŸJSONå½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã«å¤‰æ›ã—ã¦ã€Œdataã€ã«å…¥ã‚Œã‚‹
                    const temp = data.main.temp;            //ãƒ‡ãƒ¼ã‚¿ã®ä¸­ã‹ã‚‰ã€Œmain.tempã€(æ°—æ¸©)ã‚’å–ã‚Šå‡ºã™
                    const weather = data.weather[0].description;    //ãƒ‡ãƒ¼ã‚¿ã®ä¸­ã‹ã‚‰ã€Œweather[0].descriptionã€ï¼ˆå¤©æ°—ï¼‰ã‚’å–ã‚Šå‡ºã™

                    result.innerHTML = `ğŸŒ¡ï¸ æ°—æ¸©ï¼š${temp}â„ƒ<br>â˜ï¸ å¤©æ°—ï¼š${weather}`;      //ãƒ–ãƒ©ã‚¦ã‚¶ã«æ°—æ¸©ã¨å¤©æ°—ã‚’è¡¨ç¤º
                } catch (error) {
                    result.innerHTML = `âš ï¸ ã‚¨ãƒ©ãƒ¼: ${error.message}`;                   //tryå†…ã®å‡¦ç†ã§ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«è¡¨ç¤º
                }
            });
        }
    </script>

</body>

</html>